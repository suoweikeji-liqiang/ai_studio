## 问题与证据
- 元数据编辑不完整：编辑弹窗仅更新名称/编码/描述，不支持字段列编辑（src/pages/MetadataPage.tsx:388）。
- 数据集管理缺失：没有“已定义数据集”的列表页，仅有构建向导（src/pages/DatasetBuilderPage.tsx:18）。
- 特征工程不够丰富：已有缺失填充/差分/过滤/比值/移动平均/Z-Score，但缺少默认填充策略配置、组合过滤、公式表达式与灵活滞后算子（src/pages/DatasetBuilderPage.tsx:287）。
- 训练事件类型不统一：参考后端用`mae/errors/done`，新后端用`metric`，需要统一（server/src/routes/training.ts:1）。

## 改造目标
- 元数据模板可编辑字段列，支持新增/删除/类型与单位修改、AI识别补录。
- 增设“数据集管理”页，展示列表与详情，支持快捷查看/编辑/再加工与导出。
- 强化特征工程：默认填充策略、组合过滤、公式表达式与滞后/滑窗聚合算子配置化；计划保存与复用。
- 事件与契约统一：前后端训练事件类型、特征计划与推理输入输出的契约一致。

## 详细方案
### 1) 元数据管理（模板可编辑字段）
- 编辑弹窗复用创建表单的“字段编辑表格”，进入编辑时用`schema.fields`初始化`editingFields`，提交更新时连同`fields`写入。
- 字段列支持：key/name/type/unit 修改、行增删；批量导入（CSV表头→AI识别）。
- 保存校验：
  - key 唯一、不为空
  - type 合法（Float/Int/String/Boolean/Enum）
  - unit 可选
- 交互：详情页“编辑模板”→编辑弹窗，编辑后回写 store。

### 2) 数据集管理页
- 新增`DatasetsPage`：表格列（名称/行数/时间窗/状态/Schema/处理步骤/创建时间），操作（查看/编辑/导出/再加工）。
- 详情抽屉：预览前10行、处理步骤时间线、关联Schema与属性。
- 再加工入口：打开构建器并预填选项（属性、时间窗），保存为新版本数据集。
- 导出：CSV 下载（原型可用前端序列化）。
- 导航：在侧边菜单增“数据集管理”。

### 3) 特征工程强化
- 默认填充策略：全局与按字段两层配置（ForwardFill/Zero/Mean/Median/Custom），保存到特征计划。
- 组合过滤：多条件AND/OR，支持阈值、区间、字符串匹配；条件列表可视化与可撤销。
- 公式表达式：输入公式生成新特征，支持基本算术与内置函数：
  - `lag(field,k)`、`rolling(field,window,'mean'|'max'|'min'|'std')`
  - `diff(field, order)`、`zscore(field)`、`poly(field, degree)`
  - 安全解释器（原型自研轻量 parser，禁用任意执行）
- 计划保存与复用：`POST /api/features/plans`，特征页支持加载与编辑计划；探索页“一键加入计划”。
- 预览与成本提示：预览样本应用后的字段、估算计算开销（简化评分）。

### 4) 训练事件与契约统一
- WS 事件统一为：`log|metric|artifact|done|error`（已在server实现），前端训练页按此展示；如果后续接参考后端事件，做适配层映射。
- 契约沿用已建立 Schema：`FeaturePlan.schema.json`、`InferenceInput/Output.schema.json`、`Error.schema.json`，前端校验并提示。

## 实施步骤
1. 元数据编辑增强：
  - 改造编辑弹窗，支持字段表格编辑；提交时更新`fields`。
  - 在详情页“编辑模板”逻辑中填充`editingFields`。
2. 数据集管理页：
  - 新增页面与路由，表格+详情抽屉+再加工入口+CSV导出。
  - 与`useAIStore.datasets`打通；后续可接后端持久化。
3. 特征工程强化：
  - 在构建器增加“默认填充策略”与“组合过滤”面板；保存到后端计划。
  - 增加“公式表达式”面板，内置函数（lag/rolling/diff/zscore/poly），生成特征列并可加入计划。
  - 计划加载/保存与预览。
4. 统一事件与校验：
  - 训练页统一消费`metric`并显示MAE；错误与完成态友好提示。
  - 前端在发布页调用推理时校验输入契约并展示错误格式。

## 验证与演示
- 用示例数据集`d-001`：
  - 在元数据模板中编辑字段，保存后在构建器选择属性。
  - 在数据集管理页查看列表、预览、再加工。
  - 在特征页配置填充/过滤/公式表达式（如`lag(power,1)`、`rolling(temp,3,'mean')`），保存计划并应用预览。
  - 在训练页提交作业，WS事件显示指标与工件；自动注册发布；发布页试运行输出符合格式化规范。

## 交付物
- 前端改造代码（Metadata/新DatasetsPage/构建器增强/训练页适配）。
- 简要使用文档（操作路径与示例公式）。

我将按以上方案推进改造，实现原型态下更完整和流畅的业务流程，同时保留轻量实现与可对接后端的契约。