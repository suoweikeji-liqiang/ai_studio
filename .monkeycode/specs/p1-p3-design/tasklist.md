# P1-P3 任务列表

## 概述

本文档为 P1-P3（B2/B4/B5）需求的实施任务列表，详细拆解为前端、后端、测试和文档任务。

## B2: 按列名/正则自动匹配默认填充策略

### 前端任务

- [ ] B2-F1: 创建策略配置页面组件 (`FillStrategyConfigPage`)
  - 策略列表表格（增删改查）
  - 规则编辑器表单（列名/正则 + 策略下拉）
  - 规则优先级排序（上移/下移）
  - 规则测试预览功能

- [ ] B2-F2: 在数据集构建器中集成策略匹配
  - 监听列变化事件
  - 自动调用匹配接口
  - 显示策略来源标签
  - 允许用户覆盖默认策略

- [ ] B2-F3: 实现预览功能
  - 在预览表格中显示填充策略应用效果
  - 标注填充值的来源位置
  - 支持切换不同预览策略

- [ ] B2-F4: 策略配置导出/导入
  - 支持导出为 JSON 格式
  - 支持导入并验证配置
  - 支持跨项目复用

### 后端任务

- [ ] B2-B1: 实现规则匹配引擎 (`FillStrategyMatcher`)
  - 按优先级排序策略
  - 支持精确匹配、前缀匹配、包含匹配、正则匹配
  - 返回匹配的策略或 None

- [ ] B2-B2: 实现策略应用器 (`FillStrategyApplicator`)
  - 支持 ffill、bfill、zero、mean、median、custom 策略
  - 处理缺失值填充
  - 返回处理后的 Series

- [ ] B2-B3: 实现策略配置 API
  - `GET /api/fill-strategies` - 获取策略配置
  - `PUT /api/fill-strategies` - 更新策略配置
  - `POST /api/fill-strategies/match` - 匹配列策略

- [ ] B2-B4: 持久化策略配置
  - 数据库表设计（strategies、dataset_strategies）
  - 支持全局和数据集级别的策略
  - 实现配置版本管理

### 测试任务

- [ ] B2-T1: 单元测试 - 规则匹配引擎
  - 测试各种匹配模式（精确、前缀、包含、正则）
  - 测试优先级排序
  - 测试无匹配情况

- [ ] B2-T2: 单元测试 - 策略应用器
  - 测试各种填充策略
  - 测试自定义值填充
  - 测试边界情况（全缺失、无缺失）

- [ ] B2-T3: 集成测试 - API 端点
  - 测试策略配置 CRUD
  - 测试列策略匹配
  - 测试数据集级别覆盖

- [ ] B2-T4: E2E 测试 - 数据集构建器流程
  - 测试新增列自动匹配策略
  - 测试预览功能
  - 测试策略覆盖

### 文档任务

- [ ] B2-D1: API 文档
  - 填充策略接口文档
  - 请求/响应示例
  - 错误码说明

- [ ] B2-D2: 用户指南
  - 如何配置填充策略
  - 如何自定义规则
  - 如何导出/导入配置

---

## B4: 相似度分析（找与今天/明天类似的历史日期）

### 前端任务

- [ ] B4-F1: 创建相似度分析查询面板 (`SimilarityQueryPanel`)
  - 目标日期选择器（今天/明天/自定义）
  - 特征选择复选框（天气/用能/时间）
  - 特征权重滑块
  - 相似度阈值和 TopN 配置
  - 算法选择（欧氏距离/DTW）

- [ ] B4-F2: 实现相似日期结果展示
  - 相似日期表格（可排序）
  - 关键特征对比卡片
  - 特征对比雷达图
  - 历史趋势线图
  - 策略建议卡片

- [ ] B4-F3: 实现查询配置管理
  - 保存查询配置
  - 加载查询配置
  - 配置列表管理

- [ ] B4-F4: 集成到数据探索页面
  - 在探索页面添加相似度分析入口
  - 支持从探索结果跳转到相似度分析
  - 记录查询历史

### 后端任务

- [ ] B4-B1: 实现特征标准化 (`FeatureNormalizer`)
  - Z-score 标准化
  - 支持 fit/transform 模式
  - 保存标准化参数

- [ ] B4-B2: 实现相似度计算引擎 (`SimilarityEngine`)
  - 加权欧氏距离计算
  - DTW 距离计算
  - 相似度分数转换
  - Top-N 相似日期查找

- [ ] B4-B3: 实现策略生成器 (`StrategyGenerator`)
  - 基于相似日期生成策略建议
  - 计算负荷预测范围
  - 生成自然语言描述

- [ ] B4-B4: 实现相似度分析 API
  - `POST /api/explore/similarity` - 查询相似日期
  - `GET /api/explore/similarity/range` - 获取可用日期范围
  - `POST /api/explore/similarity/config` - 保存查询配置
  - `GET /api/explore/similarity/config/:id` - 加载查询配置

- [ ] B4-B5: 性能优化
  - 缓存历史数据标准化结果
  - 并行计算相似度
  - 支持增量更新

### 测试任务

- [ ] B4-T1: 单元测试 - 特征标准化
  - 测试标准化计算
  - 测试参数保存和加载

- [ ] B4-T2: 单元测试 - 相似度计算
  - 测试加权欧氏距离
  - 测试 DTW 距离
  - 测试 Top-N 查找

- [ ] B4-T3: 单元测试 - 策略生成
  - 测试策略生成逻辑
  - 测试边界情况（无相似日期）

- [ ] B4-T4: 集成测试 - API 端点
  - 测试相似度查询
  - 测试配置管理
  - 测试性能（响应时间 < 2秒）

- [ ] B4-T5: E2E 测试 - 相似度分析流程
  - 测试查询面板
  - 测试结果展示
  - 测试策略建议

### 文档任务

- [ ] B4-D1: API 文档
  - 相似度分析接口文档
  - 请求/响应示例
  - 算法说明

- [ ] B4-D2: 用户指南
  - 如何使用相似度分析
  - 如何调整特征权重
  - 如何解读相似度分数

---

## B5: 分类式智能探索面板

### 前端任务

- [ ] B5-F1: 创建智能探索主面板 (`SmartExploreDashboard`)
  - 搜索栏
  - 分类树导航
  - 分类卡片网格（支持 grid/list 布局）
  - 统计面板

- [ ] B5-F2: 实现分类卡片组件 (`CategoryCard`)
  - 卡片布局和样式
  - 工况徽章展示
  - 快速操作按钮

- [ ] B5-F3: 实现工况分布可视化
  - 工况分布饼图/环形图
  - 图例展示
  - 数据标签

- [ ] B5-F4: 实现分析模板应用
  - 从模板配置数据集
  - 应用筛选条件
  - 加载可视化视图

- [ ] B5-F5: 实现面板配置管理
  - 自定义卡片布局
  - 调整工况标签
  - 隐藏/显示卡片
  - 创建自定义卡片

### 后端任务

- [ ] B5-B1: 实现工况识别引擎 (`WorkConditionClassifier`)
  - 根据规则分类数据
  - 支持多种筛选条件
  - 计算工况统计信息

- [ ] B5-B2: 实现模板管理服务 (`TemplateService`)
  - 获取分析模板
  - 应用模板到数据集
  - 生成可视化配置

- [ ] B5-B3: 实现分类体系 API
  - `GET /api/explore/categories` - 获取分类体系
  - `GET /api/explore/work-conditions` - 获取工况统计
  - `GET /api/explore/templates/:id` - 获取分析模板
  - `PUT /api/explore/dashboard/config` - 保存面板配置
  - `POST /api/explore/custom-cards` - 创建自定义卡片

- [ ] B5-B4: 预置分类体系和模板
  - 能效分析分类及模板
  - 异常检测分类及模板
  - 设备健康分类及模板
  - 预置工况标签（舒适/炎热/正常/故障/检修）

### 测试任务

- [ ] B5-T1: 单元测试 - 工况识别引擎
  - 测试规则分类逻辑
  - 测试统计计算

- [ ] B5-T2: 单元测试 - 模板管理服务
  - 测试模板应用
  - 测试筛选条件
  - 测试可视化生成

- [ ] B5-T3: 集成测试 - API 端点
  - 测试分类体系获取
  - 测试工况统计
  - 测试模板管理
  - 测试面板配置

- [ ] B5-T4: E2E 测试 - 智能探索流程
  - 测试面板展示
  - 测试卡片点击跳转
  - 测试自定义卡片创建

### 文档任务

- [ ] B5-D1: API 文档
  - 分类体系接口文档
  - 模板管理接口文档
  - 面板配置接口文档

- [ ] B5-D2: 用户指南
  - 如何使用智能探索面板
  - 如何创建自定义卡片
  - 如何配置工况标签

---

## 里程碑

### M1.1 目标
- B2、B4、B5 的最小可行实现
- 核心功能可用，UI 完整
- 基本测试覆盖

### 验收标准
- [ ] 所有 P1-P3 功能任务完成
- [ ] 单元测试覆盖率 > 80%
- [ ] 集成测试通过
- [ ] API 文档完整
- [ ] 用户指南完成

### 优先级说明
- **P1 (B2)**: 最高优先级，影响数据处理核心流程
- **P2 (B4)**: 中等优先级，提升数据探索能力
- **P3 (B5)**: 较低优先级，优化用户体验

## 依赖关系

```
B2 (填充策略) ← 独立模块，可并行开发
B4 (相似度分析) ← 依赖数据探索基础设施
B5 (智能面板) ← 依赖 B4 的结果展示
```

## 风险和阻塞

- [ ] Airflow+MLflow 环境未搭建 → 可能阻塞 B4 和 B5 的大规模数据测试
- [ ] 样本数据未准备 → 影响功能验证
- [ ] 前端框架选型未定 → 影响开发效率
